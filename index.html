<html>
<head>
  <title>Canvas</title>
</head>
<body onload="drawFractal()">
<canvas id="myCanvas" width="1920" height="1080"></canvas>
<br>
X: <input type="text" id="x" value="0" /><br>
Y: <input type="text" id="y" value="0" /><br>
Z: <input type="text" id="z" value="1" /><br>
<input type="button" value="Update" onclick="updateLoc()" />
<script>
var gradientScale=0.25;
var gradientTranslation=2;
var xLoc=0;
var yLoc=0;
var zoom=1;
var BAILOUT=256;
BAILOUT*=BAILOUT;
var MAX_ITER=120;
var LOG2 = Math.log(2);

function updateLoc() {
    xLoc = parseFloat(document.getElementById("x").value);
    yLoc = parseFloat(document.getElementById("y").value);
    zoom = parseFloat(document.getElementById("z").value);
    drawFractal();
}

function getGradient(i) {
    var out = new Array(4);
    out[0]=Math.floor((1+Math.sin(i*gradientScale+gradientTranslation))*128);
    out[1]=Math.floor((1+Math.cos(i*gradientScale+gradientTranslation))*128);
    out[2]=Math.floor((1.5+Math.sin(i*gradientScale+gradientTranslation)+Math.cos(i*gradientScale+gradientTranslation))*96);
    out[3]=255;
    return out;
}

function getFractal(x,y) {
    var xNew=x, yNew=y;
    var i,temp;
    for(i=0;i<MAX_ITER&&xNew*xNew+yNew*yNew<BAILOUT;i++) {
        temp = xNew*xNew - yNew*yNew + x;
        yNew = 2*xNew*yNew + y;
        xNew = temp;
    }
    if(i<MAX_ITER) {
        var lg = Math.log(xNew*xNew+yNew*yNew)/2;
        var nu = Math.log(lg/LOG2)/LOG2;
        return getGradient(i+1-nu);
    }
    else {
        return getGradient(71);
    }
}

function getBuffer(w,h) {
  var out=new Array(w);
  console.log("w="+w+",h="+h);
  for(var x=0;x<w;x++) {
    out[x]=new Array(h);
    for(var y=0;y<h;y++) {
      out[x][y]=getFractal(x*4/zoom/w-2/zoom+xLoc,y*4*h/w/zoom/h-2*h/w/zoom+yLoc);
    }
  }
  return out;
}
</script>
<script>
function drawFractal() {
  var c=document.getElementById("myCanvas");
  var ctx=c.getContext("2d");
  var w = c.width, h=c.height;
  //var w=400,h=400;
  var imgData=ctx.createImageData(w,h);
  var buffer = getBuffer(w,h);
  for (var i=0;i<imgData.data.length;i+=4) {
    x=(i/4)%w;
    y=Math.floor(i*h/imgData.data.length);
    imgData.data[i+0]=buffer[x][y][0];
    imgData.data[i+1]=buffer[x][y][1];
    imgData.data[i+2]=buffer[x][y][2];
    imgData.data[i+3]=buffer[x][y][3];
  }
  ctx.putImageData(imgData,0,0);
}
</script>
</body>
</html>
